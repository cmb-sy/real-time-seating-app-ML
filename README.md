# Real-time Seating App ML API

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åº§å¸­ã‚¢ãƒ—ãƒªã® ML ç”¨ API ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€FastAPI ã¨ Supabase ã‚’ä½¿ç”¨ã—ã¦ã€`density_history`ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ API ã‚’æä¾›ã—ã¾ã™ã€‚

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Python**: 3.13.2
- **FastAPI**: Web API ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Supabase**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆPostgreSQLï¼‰
- **UV**: Python ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«
- **Uvicorn**: ASGI ã‚µãƒ¼ãƒãƒ¼

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
uv sync
```

### 2. ä»®æƒ³ç’°å¢ƒã®æœ‰åŠ¹åŒ–

```bash
source .venv/bin/activate
```

### 3. ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
python start_server.py
```

ã¾ãŸã¯

```bash
uvicorn main:app --reload
```

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### åŸºæœ¬ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /` - ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `GET /health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèªï¼‰

### ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /density_history` - å…¨ã¦ã®å¯†åº¦å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- `GET /density_history/recent/{limit}` - æœ€æ–°ã®å¯†åº¦å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®šä»¶æ•°å–å¾—
- `GET /density_history/count` - å¯†åº¦å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®ç·ä»¶æ•°ã‚’å–å¾—

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

```json
{
  "success": true,
  "count": 150,
  "data": [
    {
      "id": 1,
      "density": 0.75,
      "timestamp": "2024-01-15T10:30:00Z",
      "location": "area_1"
    }
  ],
  "message": "density_historyãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ 150 ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ"
}
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
.
â”œâ”€â”€ main.py           # FastAPIãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ database.py       # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š
â”œâ”€â”€ config.py         # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ start_server.py   # ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ pyproject.toml    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¾å­˜é–¢ä¿‚
â””â”€â”€ README.md         # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## é–‹ç™ºè€…å‘ã‘æƒ…å ±

### ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜

#### 1. config.py

Supabase ã®æ¥ç¶šæƒ…å ±ï¼ˆURLã€API ã‚­ãƒ¼ï¼‰ã‚’ç®¡ç†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

#### 2. database.py

Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ç®¡ç†ã—ã¾ã™ã€‚

#### 3. main.py

FastAPI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ï¼š

- API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®šç¾©
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ä¸»è¦ãªæ©Ÿèƒ½

1. **å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—** (`/density_history`)

   - `density_history`ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
   - Supabase Python ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®`select("*")`ã‚’ä½¿ç”¨

2. **æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—** (`/density_history/recent/{limit}`)

   - æŒ‡å®šã—ãŸä»¶æ•°ã®æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
   - `order("created_at", desc=True)`ã§é™é †ã‚½ãƒ¼ãƒˆ

3. **ãƒ‡ãƒ¼ã‚¿ä»¶æ•°å–å¾—** (`/density_history/count`)
   - ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’å–å¾—
   - `count="exact"`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
- ã‚¯ã‚¨ãƒªå®Ÿè¡Œã‚¨ãƒ©ãƒ¼
- HTTP ä¾‹å¤–å‡¦ç†

API å®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€é©åˆ‡ãª HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã•ã‚Œã¾ã™ã€‚

## æ³¨æ„äº‹é …

- æœ¬ç•ªç’°å¢ƒã§ã¯ã€è¨­å®šæƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™
- API ã‚­ãƒ¼ãªã©ã®æ©Ÿå¯†æƒ…å ±ã¯é©åˆ‡ã«ç®¡ç†ã—ã¦ãã ã•ã„
- å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹éš›ã¯ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…ã‚’æ¤œè¨ã—ã¦ãã ã•ã„

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºï¼ˆTypeScript + Next.jsï¼‰

### ğŸ”— **åŸºæœ¬çš„ãª API å‘¼ã³å‡ºã—**

#### 1. æ›œæ—¥æŒ‡å®šã§ã®äºˆæ¸¬å–å¾—

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰æ›œæ—¥ã®ã¿ã‚’æŒ‡å®šã—ã¦äºˆæ¸¬ã‚’å–å¾—ã™ã‚‹ 2 ã¤ã®æ–¹æ³•ï¼š

**A. å˜ä¸€ã®äºˆæ¸¬å€¤å–å¾—ï¼ˆæ¨å¥¨ï¼‰ï¼š**

```typescript
// æ›œæ—¥ã®ã¿ã§äºˆæ¸¬ã‚’å–å¾—
const getDayPrediction = async (dayOfWeek: number) => {
  const response = await fetch(
    `http://localhost:8000/ml/predict?day_of_week=${dayOfWeek}`
  );
  return response.json();
};

// ä½¿ç”¨ä¾‹: æœˆæ›œæ—¥ï¼ˆ0ï¼‰ã®äºˆæ¸¬ã‚’å–å¾—
const prediction = await getDayPrediction(0);
console.log(`${prediction.weekday_name}ã®äºˆæ¸¬:`);
console.log(`å¯†åº¦ç‡: ${prediction.predictions.density_rate}%`);
console.log(`å æœ‰åº§å¸­æ•°: ${prediction.predictions.occupied_seats}å¸­`);
```

**B. 24 æ™‚é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾—ï¼ˆè©³ç´°åˆ†æç”¨ï¼‰ï¼š**

```typescript
// 1æ—¥åˆ†ã®äºˆæ¸¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å–å¾—
const getDaySchedule = async (dayOfWeek: number) => {
  const response = await fetch(
    `http://localhost:8000/ml/predict_schedule?day_of_week=${dayOfWeek}`
  );
  return response.json();
};

// ä½¿ç”¨ä¾‹: æœˆæ›œæ—¥ï¼ˆ0ï¼‰ã®24æ™‚é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
const schedule = await getDaySchedule(0);
console.log(`${schedule.data.weekday_name}ã®äºˆæ¸¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«:`);
schedule.data.schedule.forEach((hour) => {
  console.log(
    `${hour.time}: å¯†åº¦ç‡${hour.predictions.density_rate}%, åº§å¸­æ•°${hour.predictions.occupied_seats}å¸­`
  );
});
```

#### 2. åŒ…æ‹¬çš„åˆ†æãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ2 é€±é–“ã”ã¨æ›´æ–°ï¼‰

2 é€±é–“ã”ã¨ã«æ›´æ–°ã•ã‚Œã‚‹åŒ…æ‹¬çš„ãªåˆ†æãƒ»äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼š

```typescript
// åŒ…æ‹¬çš„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const getAnalysisData = async () => {
  const response = await fetch(`http://localhost:8000/frontend_data/latest`);
  return response.json();
};

// ä½¿ç”¨ä¾‹: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–æ™‚
const analysisData = await getAnalysisData();
console.log("æœ€æ–°åˆ†æãƒ‡ãƒ¼ã‚¿:", analysisData.data.metadata.generated_at);
console.log("åŸºæœ¬çµ±è¨ˆ:", analysisData.data.analysis.basic_statistics);
console.log("æ›œæ—¥åˆ¥åˆ†æ:", analysisData.data.analysis.weekday_analysis);
```

#### 3. æ–°ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆç®¡ç†è€…ç”¨ï¼‰

2 é€±é–“ã‚µã‚¤ã‚¯ãƒ«å¤–ã§æ–°ã—ã„åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶ç”Ÿæˆï¼š

```typescript
// æ–°ã—ã„åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
const generateNewData = async () => {
  const response = await fetch(`http://localhost:8000/generate_frontend_data`, {
    method: "POST",
  });
  return response.json();
};

// ä½¿ç”¨ä¾‹: ç®¡ç†è€…ãŒæ‰‹å‹•ã§ãƒ‡ãƒ¼ã‚¿æ›´æ–°
const newData = await generateNewData();
console.log("æ–°ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†:", newData.success);
```

### ğŸ¯ **æ©Ÿæ¢°å­¦ç¿’ã®æ”¹å–„ç‚¹**

#### å¼·åŒ–ã•ã‚ŒãŸç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°

- **æ™‚é–“å¸¯ã‚«ãƒ†ã‚´ãƒª**: æ·±å¤œæ—©æœ/åˆå‰/åˆå¾Œ/å¤œé–“ã®åˆ†é¡
- **ãƒ”ãƒ¼ã‚¯æ™‚é–“ãƒ•ãƒ©ã‚°**: å–¶æ¥­æ™‚é–“å†…ã®ãƒ”ãƒ¼ã‚¯åˆ¤å®š
- **é€±ã®å‰åŠãƒ»å¾ŒåŠ**: æ›œæ—¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è©³ç´°åˆ†æ
- **ç›¸äº’ä½œç”¨ç‰¹å¾´é‡**: æ›œæ—¥ Ã— æ™‚é–“ã®çµ„ã¿åˆã‚ã›åŠ¹æœ

#### ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’å¯¾å¿œ

- è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹äºˆæ¸¬ç²¾åº¦å‘ä¸Š
- Random Forest, Gradient Boosting, Ridge, Elastic Net, SVR ã®æœ€é©çµ„ã¿åˆã‚ã›
- Optuna ã«ã‚ˆã‚‹è‡ªå‹•ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–

#### é«˜ç²¾åº¦äºˆæ¸¬

- å¹³æ—¥ãƒ‡ãƒ¼ã‚¿ï¼ˆæœˆ-é‡‘ï¼‰ã«ç‰¹åŒ–ã—ãŸå­¦ç¿’
- æ™‚ç³»åˆ—ç‰¹å¾´é‡ã®å††å½¢ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- äº¤å·®æ¤œè¨¼ã«ã‚ˆã‚‹æ±åŒ–æ€§èƒ½ã®ç¢ºä¿

### ğŸ“‹ **æ›œæ—¥ã®å€¤**

- `0`: æœˆæ›œæ—¥
- `1`: ç«æ›œæ—¥
- `2`: æ°´æ›œæ—¥
- `3`: æœ¨æ›œæ—¥
- `4`: é‡‘æ›œæ—¥

### ğŸ”„ **ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚µã‚¤ã‚¯ãƒ«**

- **äºˆæ¸¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« API**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‘¼ã³å‡ºã—å¯èƒ½
- **åˆ†æãƒ‡ãƒ¼ã‚¿**: 2 é€±é–“ã”ã¨ã«è‡ªå‹•æ›´æ–°
- **ãƒ¢ãƒ‡ãƒ«**: 2 é€±é–“ã”ã¨ã«å†è¨“ç·´

### ğŸŒ **ç’°å¢ƒè¨­å®š**

```bash
# .env.local
NEXT_PUBLIC_API_URL=http://localhost:8000
```

## ğŸ“š **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹**

### ğŸ”® **æ©Ÿæ¢°å­¦ç¿’äºˆæ¸¬ API**

#### 1. æ›œæ—¥æŒ‡å®šäºˆæ¸¬

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /ml/predict`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**

- `day_of_week` (å¿…é ˆ): æ›œæ—¥ï¼ˆ0-4: æœˆ-é‡‘ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "day_of_week": 1,
  "weekday_name": "ç«æ›œ",
  "predictions": {
    "density_rate": 31.4,
    "occupied_seats": 2
  },
  "message": "ç«æ›œã®äºˆæ¸¬ã‚’ç”Ÿæˆã—ã¾ã—ãŸ"
}
```

#### 2. 24 æ™‚é–“äºˆæ¸¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /ml/predict_schedule`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**

- `day_of_week` (å¿…é ˆ): æ›œæ—¥ï¼ˆ0-4: æœˆ-é‡‘ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "data": {
    "day_of_week": 2,
    "weekday_name": "æ°´æ›œ",
    "schedule": [
      {
        "hour": 0,
        "time": "00:00",
        "predictions": {
          "density_rate": 38.87,
          "occupied_seats": 3
        }
      },
      {
        "hour": 12,
        "time": "12:00",
        "predictions": {
          "density_rate": 38.87,
          "occupied_seats": 3
        }
      }
    ]
  },
  "message": "æ°´æ›œã®1æ—¥äºˆæ¸¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ"
}
```

### ğŸ“Š **ãƒ‡ãƒ¼ã‚¿å–å¾— API**

#### 1. å¯†åº¦å±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /density_history`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
[
  {
    "id": 4,
    "occupied_seats": 3,
    "density_rate": 20.0,
    "created_at": "2025-06-09T10:00:26.712761+00:00",
    "day_of_week": 1
  },
  {
    "id": 7,
    "occupied_seats": 4,
    "density_rate": 10.0,
    "created_at": "2025-06-10T08:19:41.326666+00:00",
    "day_of_week": 2
  }
]
```

#### 2. æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /density_history/recent/{limit}`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**

- `limit`: å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "count": 10,
  "limit": 10,
  "data": [
    {
      "id": 110,
      "occupied_seats": 8,
      "density_rate": 30.0,
      "created_at": "2025-06-11T08:19:08+00:00",
      "day_of_week": 3
    }
  ],
  "message": "æœ€æ–° 10 ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ"
}
```

### ğŸ“ˆ **åˆ†æ API**

#### 1. åŸºæœ¬çµ±è¨ˆæƒ…å ±

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /analysis/basic_statistics`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "data": {
    "overall": {
      "total_records": 54,
      "density_rate_mean": 34.07,
      "density_rate_std": 15.23,
      "density_rate_min": 10.0,
      "density_rate_max": 50.0,
      "occupied_seats_mean": 2.7,
      "occupied_seats_std": 1.8,
      "occupied_seats_min": 1,
      "occupied_seats_max": 8
    }
  },
  "message": "åŸºæœ¬çµ±è¨ˆæƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ"
}
```

#### 2. æ›œæ—¥åˆ¥åˆ†æ

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /analysis/weekday_analysis`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "data": {
    "detailed_stats": {
      "æœˆæ›œ": {
        "count": 10,
        "density_rate_mean": 32.18,
        "density_rate_std": 14.52,
        "occupied_seats_mean": 2.4
      },
      "ç«æ›œ": {
        "count": 12,
        "density_rate_mean": 35.25,
        "density_rate_std": 16.33,
        "occupied_seats_mean": 2.8
      }
    },
    "summary": {
      "busiest_day": "ç«æ›œ",
      "quietest_day": "é‡‘æ›œ"
    }
  },
  "message": "æ›œæ—¥åˆ¥åˆ†æã‚’å®Ÿè¡Œã—ã¾ã—ãŸ"
}
```

#### 3. åŒ…æ‹¬çš„åˆ†æãƒ‡ãƒ¼ã‚¿

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /frontend_data/latest`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "data": {
    "metadata": {
      "generated_at": "2025-06-11T23:43:27.123456",
      "data_period": "2é€±é–“",
      "total_records": 54,
      "weekday_records": 54
    },
    "analysis": {
      "basic_statistics": {
        "overall": {
          "density_rate_mean": 34.07,
          "occupied_seats_mean": 2.7
        }
      },
      "weekday_analysis": {
        "æœˆæ›œ": { "density_rate_mean": 32.18 },
        "ç«æ›œ": { "density_rate_mean": 35.25 }
      },
      "correlation_analysis": {
        "density_vs_seats": 0.85
      }
    },
    "predictions": {
      "schedules": {
        "æœˆæ›œ": {
          "day_of_week": 0,
          "weekday_name": "æœˆæ›œ",
          "schedule": []
        }
      }
    }
  },
  "message": "åŒ…æ‹¬çš„åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ"
}
```

### ğŸ”§ **ç®¡ç† API**

#### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‘ã‘ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /generate_frontend_data`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "data": {
    "metadata": {
      "generated_at": "2025-06-11T23:43:27.123456"
    }
  },
  "files": {
    "latest": "frontend_data/latest_data.json",
    "archive": "frontend_data/data_20250611_234327.json"
  },
  "message": "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‘ã‘ãƒ‡ãƒ¼ã‚¿ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ"
}
```

#### 2. ãƒ¢ãƒ‡ãƒ«è¨“ç·´

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /ml/train_models`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**

```json
{
  "success": true,
  "data": {
    "density": {
      "model_type": "random_forest",
      "test_rmse": 13.9477,
      "test_r2": 0.7234
    },
    "seats": {
      "model_type": "gradient_boosting",
      "test_rmse": 1.123,
      "test_r2": 0.8567
    }
  },
  "message": "ãƒ¢ãƒ‡ãƒ«è¨“ç·´ãŒå®Œäº†ã—ã¾ã—ãŸ"
}
```

## ğŸ¤– **æ©Ÿæ¢°å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ è©³ç´°**

### ğŸ“‹ **å­¦ç¿’ãƒ‡ãƒ¼ã‚¿**

**ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹:** `density_history` ãƒ†ãƒ¼ãƒ–ãƒ«

- **ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°:** 54 ä»¶ï¼ˆ2025 å¹´ 4 æœˆã€œ6 æœˆã®å¹³æ—¥ãƒ‡ãƒ¼ã‚¿ï¼‰
- **å¯¾è±¡æœŸé–“:** å¹³æ—¥ã®ã¿ï¼ˆæœˆæ›œã€œé‡‘æ›œï¼‰
- **ãƒ‡ãƒ¼ã‚¿å“è³ª:** ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ¸ˆã¿ã€ç•°å¸¸å€¤å‡¦ç†æ¸ˆã¿

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ :**

```json
{
  "id": 4,
  "occupied_seats": 3, // å æœ‰åº§å¸­æ•°ï¼ˆç›®æ¨™å¤‰æ•°1ï¼‰
  "density_rate": 20.0, // å¯†åº¦ç‡%ï¼ˆç›®æ¨™å¤‰æ•°2ï¼‰
  "created_at": "2025-06-09T10:00:26+00:00",
  "day_of_week": 1 // æ›œæ—¥ï¼ˆ0-4: æœˆ-é‡‘ï¼‰
}
```

### ğŸ¯ **äºˆæ¸¬å¯¾è±¡**

1. **å¯†åº¦ç‡ï¼ˆDensity Rateï¼‰**

   - ç¯„å›²: 0-100%
   - æ„å‘³: åº§å¸­åˆ©ç”¨ç‡ã®æŒ‡æ¨™
   - ç”¨é€”: æ··é›‘åº¦ã®æŠŠæ¡

2. **å æœ‰åº§å¸­æ•°ï¼ˆOccupied Seatsï¼‰**
   - ç¯„å›²: 1-8 å¸­ï¼ˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ç¯„å›²ï¼‰
   - æ„å‘³: å®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹åº§å¸­æ•°
   - ç”¨é€”: å…·ä½“çš„ãªåˆ©ç”¨çŠ¶æ³ã®æŠŠæ¡

### ğŸ§  **æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«**

#### ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ä½¿ç”¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ :**

1. **Random Forest**

   - éç·šå½¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ•æ‰
   - ç‰¹å¾´é‡é‡è¦åº¦ã®åˆ†æ
   - éå­¦ç¿’ã®æŠ‘åˆ¶

2. **Gradient Boosting**

   - é€æ¬¡çš„ãªèª¤å·®æ”¹å–„
   - é«˜ã„äºˆæ¸¬ç²¾åº¦
   - è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã®å­¦ç¿’

3. **Ridge å›å¸°**

   - ç·šå½¢é–¢ä¿‚ã®æ•æ‰
   - æ­£å‰‡åŒ–ã«ã‚ˆã‚‹æ±åŒ–æ€§èƒ½å‘ä¸Š
   - è§£é‡ˆã—ã‚„ã™ã„ãƒ¢ãƒ‡ãƒ«

4. **Elastic Net**

   - L1/L2 æ­£å‰‡åŒ–ã®çµ„ã¿åˆã‚ã›
   - ç‰¹å¾´é¸æŠæ©Ÿèƒ½
   - ã‚¹ãƒ‘ãƒ¼ã‚¹ãªãƒ¢ãƒ‡ãƒ«

5. **SVR (Support Vector Regression)**
   - éç·šå½¢é–¢ä¿‚ã®æ•æ‰
   - ãƒ­ãƒã‚¹ãƒˆãªäºˆæ¸¬
   - å¤–ã‚Œå€¤ã«å¼·ã„

#### æœ€é©åŒ–æ‰‹æ³•

**Optuna ã«ã‚ˆã‚‹è‡ªå‹•ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–:**

- **æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ :** Tree-structured Parzen Estimator (TPE)
- **è©•ä¾¡æŒ‡æ¨™:** RMSEï¼ˆRoot Mean Square Errorï¼‰
- **äº¤å·®æ¤œè¨¼:** 5-fold Cross Validation
- **è©¦è¡Œå›æ•°:** 50-100 å›ï¼ˆè¨­å®šå¯èƒ½ï¼‰

**æœ€é©åŒ–å¯¾è±¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹:**

```python
# Random Forest
{
    'n_estimators': [50, 100, 200, 300],
    'max_depth': [3, 5, 10, 15, None],
    'min_samples_split': [2, 5, 10],
    'min_samples_leaf': [1, 2, 4]
}

# Gradient Boosting
{
    'n_estimators': [50, 100, 200],
    'learning_rate': [0.01, 0.1, 0.2],
    'max_depth': [3, 5, 7],
    'subsample': [0.8, 0.9, 1.0]
}
```

### ğŸ”§ **ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°**

#### åŸºæœ¬ç‰¹å¾´é‡

1. **æ›œæ—¥ï¼ˆday_of_weekï¼‰**: 0-4ï¼ˆæœˆ-é‡‘ï¼‰

#### é«˜åº¦ãªç‰¹å¾´é‡

1. **å††å½¢ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**

   ```python
   day_sin = sin(2Ï€ Ã— day_of_week / 7)
   day_cos = cos(2Ï€ Ã— day_of_week / 7)
   ```

2. **æ›œæ—¥ãƒ‘ã‚¿ãƒ¼ãƒ³**

   - é€±å§‹ã‚ï¼ˆæœˆæ›œï¼‰
   - é€±ä¸­ï¼ˆç«æ›œ-æ°´æ›œï¼‰
   - é€±å¾ŒåŠï¼ˆæœ¨æ›œ-é‡‘æ›œï¼‰

3. **æ›œæ—¥ç‰¹æ€§**

   - å„æ›œæ—¥ã®å›ºæœ‰ãƒ‘ã‚¿ãƒ¼ãƒ³
   - æ›œæ—¥é–“ã®ç›¸é–¢é–¢ä¿‚
   - å¹³æ—¥ç‰¹æœ‰ã®åˆ©ç”¨å‚¾å‘

### ğŸ“Š **ãƒ¢ãƒ‡ãƒ«æ€§èƒ½è©•ä¾¡**

#### ç¾åœ¨ã®æ€§èƒ½æŒ‡æ¨™

**å¯†åº¦ç‡äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«:**

- **RMSE**: 13.9477
- **RÂ² ã‚¹ã‚³ã‚¢**: 0.7234
- **MAE**: 11.2

**å æœ‰åº§å¸­æ•°äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«:**

- **RMSE**: 1.1230
- **RÂ² ã‚¹ã‚³ã‚¢**: 0.8567
- **MAE**: 0.89

#### è©•ä¾¡æ–¹æ³•

1. **äº¤å·®æ¤œè¨¼**: 5-fold CV ã§ãƒ¢ãƒ‡ãƒ«ã®æ±åŒ–æ€§èƒ½ã‚’è©•ä¾¡
2. **ãƒ›ãƒ¼ãƒ«ãƒ‰ã‚¢ã‚¦ãƒˆæ¤œè¨¼**: 80/20 åˆ†å‰²ã§ãƒ†ã‚¹ãƒˆæ€§èƒ½ã‚’è©•ä¾¡
3. **æ™‚ç³»åˆ—åˆ†å‰²**: æ™‚é–“é †åºã‚’è€ƒæ…®ã—ãŸæ¤œè¨¼

## ğŸ“ˆ **ãƒ‡ãƒ¼ã‚¿åˆ†æã‚·ã‚¹ãƒ†ãƒ è©³ç´°**

### ğŸ” **åŸºæœ¬çµ±è¨ˆåˆ†æ**

#### å…¨ä½“çµ±è¨ˆ

- **ãƒ‡ãƒ¼ã‚¿æœŸé–“**: 2025 å¹´ 4 æœˆã€œ6 æœˆ
- **ç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°**: 54 ä»¶
- **æ›œæ—¥åˆ†å¸ƒ**: å¹³æ—¥ã®ã¿ï¼ˆåœŸæ—¥é™¤å¤–ï¼‰
- **æ™‚é–“åˆ†å¸ƒ**: å…¨æ™‚é–“å¸¯ã‚’ã‚«ãƒãƒ¼

#### è¨˜è¿°çµ±è¨ˆ

```python
{
  "density_rate": {
    "mean": 34.07,
    "std": 15.23,
    "min": 10.0,
    "max": 50.0,
    "25%": 25.0,
    "50%": 38.0,
    "75%": 50.0
  },
  "occupied_seats": {
    "mean": 2.7,
    "std": 1.8,
    "min": 1,
    "max": 8,
    "25%": 1.0,
    "50%": 3.0,
    "75%": 4.0
  }
}
```

### ğŸ“… **æ›œæ—¥åˆ¥åˆ†æ**

#### æ›œæ—¥ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ

**å„æ›œæ—¥ã®ç‰¹å¾´:**

- **æœˆæ›œæ—¥**: é€±å§‹ã‚ã§æ¯”è¼ƒçš„é™ã‹ï¼ˆå¯†åº¦ç‡: 32.18%ï¼‰
- **ç«æ›œæ—¥**: æœ€ã‚‚æ··é›‘ã™ã‚‹å‚¾å‘ï¼ˆå¯†åº¦ç‡: 35.25%ï¼‰
- **æ°´æ›œæ—¥**: ä¸­ç¨‹åº¦ã®åˆ©ç”¨ï¼ˆå¯†åº¦ç‡: 34.8%ï¼‰
- **æœ¨æ›œæ—¥**: é€±å¾ŒåŠã§å®‰å®šçš„åˆ©ç”¨
- **é‡‘æ›œæ—¥**: é€±æœ«å‰ã§å¤‰å‹•å¤§

#### çµ±è¨ˆçš„æœ‰æ„æ€§æ¤œå®š

- ANOVA ã«ã‚ˆã‚‹æ›œæ—¥é–“å·®ã®æ¤œå®š
- Tukey HSD ã«ã‚ˆã‚‹å¤šé‡æ¯”è¼ƒ
- åŠ¹æœé‡ï¼ˆCohen's dï¼‰ã®ç®—å‡º

### ğŸ”— **ç›¸é–¢åˆ†æ**

#### å¤‰æ•°é–“ç›¸é–¢

1. **å¯†åº¦ç‡ vs å æœ‰åº§å¸­æ•°**: r = 0.85ï¼ˆå¼·ã„æ­£ã®ç›¸é–¢ï¼‰
2. **æ›œæ—¥ vs å¯†åº¦ç‡**: å¼±ã„ç›¸é–¢ï¼ˆæ›œæ—¥åŠ¹æœã‚ã‚Šï¼‰
3. **æ™‚é–“ vs åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³**: ä¸­ç¨‹åº¦ã®ç›¸é–¢

#### ç›¸é–¢è¡Œåˆ—

```python
correlation_matrix = {
  "density_rate": {
    "occupied_seats": 0.85,
    "day_of_week": 0.23,
    "hour": 0.34
  },
  "occupied_seats": {
    "day_of_week": 0.19,
    "hour": 0.28
  }
}
```

### ğŸ“Š **å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ **

#### ç”Ÿæˆã•ã‚Œã‚‹ã‚°ãƒ©ãƒ•

1. **åŸºæœ¬çµ±è¨ˆã‚°ãƒ©ãƒ•**

   - ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ï¼ˆå¯†åº¦ç‡ãƒ»åº§å¸­æ•°åˆ†å¸ƒï¼‰
   - ç®±ã²ã’å›³ï¼ˆæ›œæ—¥åˆ¥æ¯”è¼ƒï¼‰
   - æ•£å¸ƒå›³ï¼ˆç›¸é–¢é–¢ä¿‚ï¼‰

2. **æ™‚ç³»åˆ—åˆ†æ**

   - æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼‰
   - æ›œæ—¥åˆ¥å¹³å‡å€¤ã®æ¨ç§»
   - å­£ç¯€æ€§ã®æ¤œå‡º

3. **äºˆæ¸¬ vs å®Ÿæ¸¬ã‚°ãƒ©ãƒ•**

   - äºˆæ¸¬ç²¾åº¦ã®è¦–è¦šçš„è©•ä¾¡
   - æ®‹å·®ãƒ—ãƒ­ãƒƒãƒˆ
   - ä¿¡é ¼åŒºé–“ã®è¡¨ç¤º

4. **ç‰¹å¾´é‡é‡è¦åº¦**
   - Random Forest ã®ç‰¹å¾´é‡é‡è¦åº¦
   - SHAP å€¤ã«ã‚ˆã‚‹èª¬æ˜å¯èƒ½ AI
   - ç‰¹å¾´é‡ç›¸é–¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—

#### ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›

- **å½¢å¼**: PNG ç”»åƒ
- **è§£åƒåº¦**: é«˜è§£åƒåº¦ï¼ˆ300 DPIï¼‰
- **ä¿å­˜å ´æ‰€**: `visualizations/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- **ãƒ•ã‚¡ã‚¤ãƒ«å**: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ã

### ğŸ”„ **è‡ªå‹•æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ **

#### 2 é€±é–“ã‚µã‚¤ã‚¯ãƒ«æ›´æ–°

1. **ãƒ‡ãƒ¼ã‚¿å–å¾—**: Supabase ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
2. **å‰å‡¦ç†**: ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã¨ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
3. **ãƒ¢ãƒ‡ãƒ«å†è¨“ç·´**: æ–°ãƒ‡ãƒ¼ã‚¿ã§ãƒ¢ãƒ‡ãƒ«ã‚’æ›´æ–°
4. **æ€§èƒ½è©•ä¾¡**: äºˆæ¸¬ç²¾åº¦ã®æ¤œè¨¼
5. **åˆ†æå®Ÿè¡Œ**: çµ±è¨ˆåˆ†æã¨å¯è¦–åŒ–ã®æ›´æ–°
6. **çµæœä¿å­˜**: JSON ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‚°ãƒ©ãƒ•ã®ä¿å­˜

#### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼æ©Ÿèƒ½

- **å®Ÿè¡Œé–“éš”**: 14 æ—¥é–“éš”
- **ãƒ­ã‚°ç®¡ç†**: å®Ÿè¡Œå±¥æ­´ã®è¨˜éŒ²
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¤±æ•—æ™‚ã®å†è©¦è¡Œæ©Ÿèƒ½
- **é€šçŸ¥æ©Ÿèƒ½**: æ›´æ–°å®Œäº†ã®é€šçŸ¥

```typescript
// API BASE URLã®è¨­å®š
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:8000";
```

### ğŸ“± **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**

**1 æ—¥ã®äºˆæ¸¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«:**

```json
{
  "success": true,
  "day_of_week": 0,
  "weekday_name": "æœˆæ›œ",
  "schedule": [
    {
      "hour": 0,
      "time": "00:00",
      "predictions": {
        "density_rate": 15.2,
        "occupied_seats": 1
      }
    },
    {
      "hour": 12,
      "time": "12:00",
      "predictions": {
        "density_rate": 32.5,
        "occupied_seats": 2
      }
    }
  ]
}
```

**åˆ†æãƒ‡ãƒ¼ã‚¿:**

```json
{
  "metadata": {
    "generated_at": "2025-06-11T23:43:27.123456",
    "total_records": 54
  },
  "analysis": {
    "basic_statistics": {
      "overall": {
        "density_rate_mean": 34.07,
        "occupied_seats_mean": 2.7
      }
    },
    "weekday_analysis": {
      "æœˆæ›œ": { "density_rate_mean": 32.18 },
      "ç«æ›œ": { "density_rate_mean": 35.25 }
    }
  }
}
```
