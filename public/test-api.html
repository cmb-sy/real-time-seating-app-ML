<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ãƒ†ã‚¹ãƒˆ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      button {
        background: #0070f3;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0051a2;
      }
      .result {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin-top: 10px;
        white-space: pre-wrap;
        font-family: monospace;
        max-height: 400px;
        overflow-y: auto;
      }
      .error {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }
      .success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }
      .endpoint {
        margin-bottom: 15px;
        padding: 10px;
        border-left: 4px solid #0070f3;
        background: #f8f9fa;
      }
    </style>
  </head>
  <body>
    <h1>ğŸš€ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åº§å¸­ã‚¢ãƒ—ãƒª API ãƒ†ã‚¹ãƒˆ</h1>

    <div class="container">
      <h2>ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</h2>

      <div class="endpoint">
        <h3>1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</h3>
        <p><strong>URL:</strong> /health ã¾ãŸã¯ /api/health</p>
        <button onclick="testEndpoint('/health', 'health-result')">
          ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆ
        </button>
        <button onclick="testEndpoint('/api/health', 'health-result-api')">
          APIãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆ
        </button>
        <div id="health-result" class="result" style="display: none"></div>
        <div id="health-result-api" class="result" style="display: none"></div>
      </div>

      <div class="endpoint">
        <h3>2. ä»Šæ—¥ãƒ»æ˜æ—¥ã®äºˆæ¸¬</h3>
        <p>
          <strong>URL:</strong> /predictions/today-tomorrow ã¾ãŸã¯
          /api/predictions/today-tomorrow
        </p>
        <button
          onclick="testEndpoint('/predictions/today-tomorrow', 'today-result')"
        >
          ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆ
        </button>
        <button
          onclick="testEndpoint('/api/predictions/today-tomorrow', 'today-result-api')"
        >
          APIãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆ
        </button>
        <div id="today-result" class="result" style="display: none"></div>
        <div id="today-result-api" class="result" style="display: none"></div>
      </div>

      <div class="endpoint">
        <h3>3. é€±é–“å¹³å‡äºˆæ¸¬</h3>
        <p>
          <strong>URL:</strong> /predictions/weekly-average ã¾ãŸã¯
          /api/predictions/weekly-average
        </p>
        <button
          onclick="testEndpoint('/predictions/weekly-average', 'weekly-result')"
        >
          ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆ
        </button>
        <button
          onclick="testEndpoint('/api/predictions/weekly-average', 'weekly-result-api')"
        >
          APIãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆ
        </button>
        <div id="weekly-result" class="result" style="display: none"></div>
        <div id="weekly-result-api" class="result" style="display: none"></div>
      </div>

      <div class="endpoint">
        <h3>4. Supabaseé€£æº</h3>
        <p><strong>URL:</strong> /supabase/sync ã¾ãŸã¯ /api/supabase/sync</p>
        <button
          onclick="testEndpoint('/supabase/sync?type=current', 'supabase-result')"
        >
          ç¾åœ¨ã®çŠ¶æ³
        </button>
        <button
          onclick="testEndpoint('/api/supabase/sync?type=predictions', 'supabase-result-api')"
        >
          äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿
        </button>
        <div id="supabase-result" class="result" style="display: none"></div>
        <div
          id="supabase-result-api"
          class="result"
          style="display: none"
        ></div>
      </div>
    </div>

    <div class="container">
      <h2>ğŸ”§ å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€æ‹¬ãƒ†ã‚¹ãƒˆ</h2>
      <button onclick="testAllEndpoints()">å…¨ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆ</button>
      <div id="all-results" class="result" style="display: none"></div>
    </div>

    <script>
      const BASE_URL = window.location.origin;

      async function testEndpoint(endpoint, resultId) {
        const resultDiv = document.getElementById(resultId);
        resultDiv.style.display = "block";
        resultDiv.className = "result";
        resultDiv.textContent = "ğŸ”„ ãƒ†ã‚¹ãƒˆä¸­...";

        try {
          const startTime = Date.now();
          const response = await fetch(`${BASE_URL}${endpoint}`);
          const endTime = Date.now();
          const responseTime = endTime - startTime;

          const data = await response.json();

          resultDiv.className = response.ok ? "result success" : "result error";
          resultDiv.textContent = `âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status} ${
            response.statusText
          }
â±ï¸ ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${responseTime}ms
ğŸ“„ ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
${JSON.stringify(data, null, 2)}`;
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}
ğŸ”— URL: ${BASE_URL}${endpoint}
ğŸ“ è©³ç´°: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯CORSã‚¨ãƒ©ãƒ¼ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™`;
        }
      }

      async function testAllEndpoints() {
        const resultDiv = document.getElementById("all-results");
        resultDiv.style.display = "block";
        resultDiv.className = "result";
        resultDiv.textContent = "ğŸ”„ å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆä¸­...";

        const endpoints = [
          "/health",
          "/api/health",
          "/predictions/today-tomorrow",
          "/api/predictions/today-tomorrow",
          "/predictions/weekly-average",
          "/api/predictions/weekly-average",
          "/supabase/sync?type=current",
          "/api/supabase/sync?type=current",
        ];

        let results = [];

        for (const endpoint of endpoints) {
          try {
            const startTime = Date.now();
            const response = await fetch(`${BASE_URL}${endpoint}`);
            const endTime = Date.now();
            const responseTime = endTime - startTime;

            results.push({
              endpoint,
              status: response.status,
              statusText: response.statusText,
              responseTime,
              success: response.ok,
            });
          } catch (error) {
            results.push({
              endpoint,
              status: "ERROR",
              statusText: error.message,
              responseTime: 0,
              success: false,
            });
          }
        }

        const successCount = results.filter((r) => r.success).length;
        const totalCount = results.length;

        resultDiv.className =
          successCount === totalCount ? "result success" : "result error";
        resultDiv.textContent = `ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ: ${successCount}/${totalCount} æˆåŠŸ

${results
  .map(
    (r) =>
      `${r.success ? "âœ…" : "âŒ"} ${r.endpoint}
   ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${r.status} ${r.statusText}
   ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${r.responseTime}ms`
  )
  .join("\n\n")}`;
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬æƒ…å ±ã‚’è¡¨ç¤º
      window.onload = function () {
        console.log("ğŸš€ API ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ");
        console.log("ğŸ“ ãƒ™ãƒ¼ã‚¹URL:", BASE_URL);
      };
    </script>
  </body>
</html>
